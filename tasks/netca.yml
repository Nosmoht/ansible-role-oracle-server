---
- name: Ensuring that Oracle Listener is running
  sudo: true
  sudo_user: '{{ oracle_db_owner_user_name }}'
  oracle_listener:
    name: '{{ item.name }}'
    port: '{{ item.port }}'
    protocol: '{{ item.protocol }}'
    oracle_home: '{{ oracle_db_homes[item.oracle_home].path }}'
    state: running
  with_items: oracle_listeners
  register: oracle_listeners_state

- name: Running Net Configuration Assistant Using a Response File
  shell: '{{ oracle_db_homes[item.0.oracle_home].path }}/bin/netca -silent -responsefile {{ oracle_db_homes[item.0.oracle_home].path }}/assistants/netca/netca.rsp'
  register: oracle_netca_output
  sudo: true
  sudo_user: '{{ oracle_db_owner_user_name }}'
  when: item.1.changed
  with_together:
  - oracle_listeners
  - oracle_listeners_state.results